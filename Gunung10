--[[
    SorbUI - ThanHub Style UI Library
    Pure UI Only - No Game Logic
]]

local SorbUI = {}
SorbUI.__index = SorbUI

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- UI Constants
local COLORS = {
    Background = Color3.fromRGB(15, 20, 35),
    Panel = Color3.fromRGB(20, 25, 45),
    Sidebar = Color3.fromRGB(18, 23, 40),
    Accent = Color3.fromRGB(0, 200, 255),
    Text = Color3.fromRGB(240, 245, 255),
    TextDim = Color3.fromRGB(150, 160, 180),
    ToggleOff = Color3.fromRGB(30, 35, 55),
    ToggleOn = Color3.fromRGB(0, 200, 255),
    Border = Color3.fromRGB(40, 50, 80)
}

local SIZES = {
    SidebarWidth = 180,
    PanelPadding = 12,
    ElementHeight = 35,
    CornerRadius = 12
}

-- Utility Functions
local function CreateElement(className, properties)
    local element = Instance.new(className)
    for prop, value in pairs(properties) do
        element[prop] = value
    end
    return element
end

local function AddCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or SIZES.CornerRadius)
    corner.Parent = parent
    return corner
end

local function AddStroke(parent, color, thickness)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or COLORS.Border
    stroke.Thickness = thickness or 1
    stroke.Transparency = 0.5
    stroke.Parent = parent
    return stroke
end

local function Tween(object, properties, duration)
    local tweenInfo = TweenInfo.new(duration or 0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- Window Class
function SorbUI:CreateWindow(title)
    local Window = {
        Tabs = {},
        CurrentTab = nil
    }
    
    -- Main ScreenGui
    local ScreenGui = CreateElement("ScreenGui", {
        Name = "SorbUI",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    -- Main Container
    local MainFrame = CreateElement("Frame", {
        Name = "MainFrame",
        Parent = ScreenGui,
        BackgroundColor3 = COLORS.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -400, 0.5, -275),
        Size = UDim2.new(0, 800, 0, 550),
        ClipsDescendants = true
    })
    AddCorner(MainFrame, 16)
    AddStroke(MainFrame, COLORS.Accent, 2)
    
    -- Glassmorphism Effect
    local Blur = CreateElement("Frame", {
        Name = "Blur",
        Parent = MainFrame,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BackgroundTransparency = 0.95,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        ZIndex = 0
    })
    
    -- Top Bar
    local TopBar = CreateElement("Frame", {
        Name = "TopBar",
        Parent = MainFrame,
        BackgroundColor3 = COLORS.Sidebar,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 50)
    })
    AddCorner(TopBar, 16)
    
    local TopBarDivider = CreateElement("Frame", {
        Name = "Divider",
        Parent = TopBar,
        BackgroundColor3 = COLORS.Accent,
        BackgroundTransparency = 0.7,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(1, 0, 0, 2)
    })
    
    local TitleLabel = CreateElement("TextLabel", {
        Name = "Title",
        Parent = TopBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 20, 0, 0),
        Size = UDim2.new(0, 300, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = title or "SorbUI",
        TextColor3 = COLORS.Text,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Sidebar
    local Sidebar = CreateElement("Frame", {
        Name = "Sidebar",
        Parent = MainFrame,
        BackgroundColor3 = COLORS.Sidebar,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 50),
        Size = UDim2.new(0, SIZES.SidebarWidth, 1, -50)
    })
    
    local SidebarList = CreateElement("UIListLayout", {
        Parent = Sidebar,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8)
    })
    
    CreateElement("UIPadding", {
        Parent = Sidebar,
        PaddingTop = UDim.new(0, 15),
        PaddingBottom = UDim.new(0, 15),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10)
    })
    
    -- Content Container
    local ContentContainer = CreateElement("Frame", {
        Name = "ContentContainer",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, SIZES.SidebarWidth + 15, 0, 65),
        Size = UDim2.new(1, -SIZES.SidebarWidth - 30, 1, -80)
    })
    
    -- Dragging functionality
    local dragging, dragInput, dragStart, startPos
    
    TopBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    TopBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Tab Creation
    function Window:CreateTab(name, icon)
        local Tab = {
            Name = name,
            Panels = {},
            Active = false
        }
        
        -- Tab Button
        local TabButton = CreateElement("TextButton", {
            Name = "TabButton",
            Parent = Sidebar,
            BackgroundColor3 = COLORS.Panel,
            BackgroundTransparency = 0.5,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 0, 40),
            AutoButtonColor = false,
            Font = Enum.Font.Gotham,
            Text = "  " .. (icon or "•") .. "  " .. name,
            TextColor3 = COLORS.TextDim,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        AddCorner(TabButton, 8)
        
        local TabIndicator = CreateElement("Frame", {
            Name = "Indicator",
            Parent = TabButton,
            BackgroundColor3 = COLORS.Accent,
            BorderSizePixel = 0,
            Position = UDim2.new(0, 0, 0, 0),
            Size = UDim2.new(0, 0, 1, 0)
        })
        AddCorner(TabIndicator, 8)
        
        -- Content Frame for this tab
        local TabContent = CreateElement("ScrollingFrame", {
            Name = name .. "Content",
            Parent = ContentContainer,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 4,
            ScrollBarImageColor3 = COLORS.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            Visible = false
        })
        
        local ContentList = CreateElement("UIListLayout", {
            Parent = TabContent,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 15)
        })
        
        ContentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabContent.CanvasSize = UDim2.new(0, 0, 0, ContentList.AbsoluteContentSize.Y + 20)
        end)
        
        CreateElement("UIPadding", {
            Parent = TabContent,
            PaddingTop = UDim.new(0, 10),
            PaddingBottom = UDim.new(0, 10)
        })
        
        Tab.ContentFrame = TabContent
        
        -- Tab Selection
        TabButton.MouseButton1Click:Connect(function()
            for _, tab in pairs(Window.Tabs) do
                tab.Active = false
                tab.ContentFrame.Visible = false
                for _, btn in pairs(Sidebar:GetChildren()) do
                    if btn:IsA("TextButton") then
                        Tween(btn, {BackgroundTransparency = 0.5})
                        Tween(btn, {TextColor3 = COLORS.TextDim})
                        local ind = btn:FindFirstChild("Indicator")
                        if ind then
                            Tween(ind, {Size = UDim2.new(0, 0, 1, 0)})
                        end
                    end
                end
            end
            
            Tab.Active = true
            Tab.ContentFrame.Visible = true
            Window.CurrentTab = Tab
            
            Tween(TabButton, {BackgroundTransparency = 0})
            Tween(TabButton, {TextColor3 = COLORS.Text})
            Tween(TabIndicator, {Size = UDim2.new(0, 4, 1, 0)})
        end)
        
        table.insert(Window.Tabs, Tab)
        
        if #Window.Tabs == 1 then
            TabButton.MouseButton1Click:Fire()
        end
        
        -- Panel Creation
        function Tab:CreatePanel(title)
            local Panel = {
                Elements = {}
            }
            
            local PanelFrame = CreateElement("Frame", {
                Name = "Panel_" .. title,
                Parent = TabContent,
                BackgroundColor3 = COLORS.Panel,
                BorderSizePixel = 0,
                Size = UDim2.new(1, 0, 0, 60),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            AddCorner(PanelFrame, SIZES.CornerRadius)
            AddStroke(PanelFrame, COLORS.Border, 1)
            
            local PanelPadding = CreateElement("UIPadding", {
                Parent = PanelFrame,
                PaddingTop = UDim.new(0, 15),
                PaddingBottom = UDim.new(0, 15),
                PaddingLeft = UDim.new(0, 15),
                PaddingRight = UDim.new(0, 15)
            })
            
            local PanelTitle = CreateElement("TextLabel", {
                Name = "PanelTitle",
                Parent = PanelFrame,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 20),
                Font = Enum.Font.GothamBold,
                Text = title,
                TextColor3 = COLORS.Text,
                TextSize = 14,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local Divider = CreateElement("Frame", {
                Name = "Divider",
                Parent = PanelFrame,
                BackgroundColor3 = COLORS.Accent,
                BackgroundTransparency = 0.7,
                BorderSizePixel = 0,
                Position = UDim2.new(0, 0, 0, 30),
                Size = UDim2.new(1, 0, 0, 1)
            })
            
            local ElementContainer = CreateElement("Frame", {
                Name = "Elements",
                Parent = PanelFrame,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 0, 0, 40),
                Size = UDim2.new(1, 0, 1, -40),
                AutomaticSize = Enum.AutomaticSize.Y
            })
            
            local ElementList = CreateElement("UIListLayout", {
                Parent = ElementContainer,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 8)
            })
            
            Panel.Container = ElementContainer
            
            -- Toggle Creation
            function Panel:CreateToggle(name, default, callback)
                callback = callback or function() end
                
                local ToggleFrame = CreateElement("Frame", {
                    Name = "Toggle",
                    Parent = ElementContainer,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, SIZES.ElementHeight)
                })
                
                local ToggleLabel = CreateElement("TextLabel", {
                    Name = "Label",
                    Parent = ToggleFrame,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 0, 0, 0),
                    Size = UDim2.new(1, -60, 1, 0),
                    Font = Enum.Font.Gotham,
                    Text = name,
                    TextColor3 = COLORS.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                
                local ToggleButton = CreateElement("TextButton", {
                    Name = "Button",
                    Parent = ToggleFrame,
                    BackgroundColor3 = default and COLORS.ToggleOn or COLORS.ToggleOff,
                    Position = UDim2.new(1, -50, 0.5, -15),
                    Size = UDim2.new(0, 50, 0, 30),
                    AutoButtonColor = false,
                    Font = Enum.Font.GothamBold,
                    Text = default and "ON" or "OFF",
                    TextColor3 = COLORS.Text,
                    TextSize = 11
                })
                AddCorner(ToggleButton, 6)
                
                local state = default
                
                if state then
                    local glow = CreateElement("UIStroke", {
                        Parent = ToggleButton,
                        Color = COLORS.Accent,
                        Thickness = 2,
                        Transparency = 0.3
                    })
                end
                
                ToggleButton.MouseButton1Click:Connect(function()
                    state = not state
                    
                    Tween(ToggleButton, {
                        BackgroundColor3 = state and COLORS.ToggleOn or COLORS.ToggleOff
                    })
                    
                    ToggleButton.Text = state and "ON" or "OFF"
                    
                    local glow = ToggleButton:FindFirstChild("UIStroke")
                    if state and not glow then
                        glow = CreateElement("UIStroke", {
                            Parent = ToggleButton,
                            Color = COLORS.Accent,
                            Thickness = 2,
                            Transparency = 0.3
                        })
                    elseif not state and glow then
                        glow:Destroy()
                    end
                    
                    callback(state)
                end)
                
                return ToggleFrame
            end
            
            -- Dropdown Creation
            function Panel:CreateDropdown(name, options, default, callback)
                callback = callback or function() end
                options = options or {"Option 1", "Option 2"}
                
                local DropdownFrame = CreateElement("Frame", {
                    Name = "Dropdown",
                    Parent = ElementContainer,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, SIZES.ElementHeight),
                    AutomaticSize = Enum.AutomaticSize.Y,
                    ClipsDescendants = false
                })
                
                local DropdownLabel = CreateElement("TextLabel", {
                    Name = "Label",
                    Parent = DropdownFrame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 20),
                    Font = Enum.Font.Gotham,
                    Text = name,
                    TextColor3 = COLORS.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                
                local DropdownButton = CreateElement("TextButton", {
                    Name = "Button",
                    Parent = DropdownFrame,
                    BackgroundColor3 = COLORS.ToggleOff,
                    Position = UDim2.new(0, 0, 0, 25),
                    Size = UDim2.new(1, 0, 0, 35),
                    AutoButtonColor = false,
                    Font = Enum.Font.Gotham,
                    Text = "  " .. (default or options[1]) .. "  ▼",
                    TextColor3 = COLORS.Text,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                AddCorner(DropdownButton, 6)
                AddStroke(DropdownButton, COLORS.Border, 1)
                
                local DropdownList = CreateElement("Frame", {
                    Name = "List",
                    Parent = DropdownFrame,
                    BackgroundColor3 = COLORS.Panel,
                    Position = UDim2.new(0, 0, 0, 65),
                    Size = UDim2.new(1, 0, 0, 0),
                    ClipsDescendants = true,
                    Visible = false
                })
                AddCorner(DropdownList, 6)
                AddStroke(DropdownList, COLORS.Accent, 1)
                
                local ListLayout = CreateElement("UIListLayout", {
                    Parent = DropdownList,
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Padding = UDim.new(0, 2)
                })
                
                CreateElement("UIPadding", {
                    Parent = DropdownList,
                    PaddingTop = UDim.new(0, 5),
                    PaddingBottom = UDim.new(0, 5)
                })
                
                local expanded = false
                local currentValue = default or options[1]
                
                for _, option in ipairs(options) do
                    local OptionButton = CreateElement("TextButton", {
                        Name = option,
                        Parent = DropdownList,
                        BackgroundColor3 = COLORS.ToggleOff,
                        BackgroundTransparency = 0.5,
                        Size = UDim2.new(1, -10, 0, 30),
                        AutoButtonColor = false,
                        Font = Enum.Font.Gotham,
                        Text = "  " .. option,
                        TextColor3 = COLORS.TextDim,
                        TextSize = 12,
                        TextXAlignment = Enum.TextXAlignment.Left
                    })
                    AddCorner(OptionButton, 4)
                    
                    OptionButton.MouseEnter:Connect(function()
                        Tween(OptionButton, {BackgroundTransparency = 0})
                    end)
                    
                    OptionButton.MouseLeave:Connect(function()
                        Tween(OptionButton, {BackgroundTransparency = 0.5})
                    end)
                    
                    OptionButton.MouseButton1Click:Connect(function()
                        currentValue = option
                        DropdownButton.Text = "  " .. option .. "  ▼"
                        
                        expanded = false
                        DropdownList.Visible = false
                        Tween(DropdownList, {Size = UDim2.new(1, 0, 0, 0)})
                        
                        callback(option)
                    end)
                end
                
                DropdownButton.MouseButton1Click:Connect(function()
                    expanded = not expanded
                    DropdownList.Visible = expanded
                    
                    if expanded then
                        local contentHeight = ListLayout.AbsoluteContentSize.Y + 10
                        Tween(DropdownList, {Size = UDim2.new(1, 0, 0, contentHeight)})
                    else
                         Tween(DropdownList, {Size = UDim2.new(1, 0, 0, 0)})
                        task.wait(0.3)
                        if not expanded then
                            DropdownList.Visible = false
                        end
                    end
                end)
                
                return DropdownFrame
            end
            
            -- Input Creation
            function Panel:CreateInput(name, default, callback)
                callback = callback or function() end
                
                local InputFrame = CreateElement("Frame", {
                    Name = "Input",
                    Parent = ElementContainer,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 60)
                })
                
                local InputLabel = CreateElement("TextLabel", {
                    Name = "Label",
                    Parent = InputFrame,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 0, 20),
                    Font = Enum.Font.Gotham,
                    Text = name,
                    TextColor3 = COLORS.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                
                local InputBox = CreateElement("TextBox", {
                    Name = "Box",
                    Parent = InputFrame,
                    BackgroundColor3 = COLORS.ToggleOff,
                    Position = UDim2.new(0, 0, 0, 25),
                    Size = UDim2.new(1, 0, 0, 35),
                    Font = Enum.Font.Gotham,
                    PlaceholderText = default or "Enter value...",
                    Text = "",
                    TextColor3 = COLORS.Text,
                    TextSize = 12,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    ClearTextOnFocus = false
                })
                AddCorner(InputBox, 6)
                AddStroke(InputBox, COLORS.Border, 1)
                
                CreateElement("UIPadding", {
                    Parent = InputBox,
                    PaddingLeft = UDim.new(0, 10)
                })
                
                InputBox.Focused:Connect(function()
                    Tween(InputBox:FindFirstChild("UIStroke"), {
                        Color = COLORS.Accent,
                        Thickness = 2
                    })
                end)

                InputBox.FocusLost:Connect(function(enterPressed)
                    Tween(InputBox:FindFirstChild("UIStroke"), {
                        Color = COLORS.Border,
                        Thickness = 1
                    })
                    
                    if enterPressed then
                        callback(InputBox.Text)
                    end
                end)
                
                return InputFrame
            end
            
            return Panel
        end
        
        return Tab
    end
    
    return Window
end

return SorbUI
